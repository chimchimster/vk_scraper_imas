import asyncio
from typing import Final

from utils import read_schema
from scarper import TasksDistributor, TaskObject, worker, connector
from api.models import ResponseModel, VKUser, SubscribedToGroup, SubscribedToUser


async def main():

    user_ids1 = ['id226245594', 'dmitriy_panfilov', 'angieozerova', 'dosia1488', 'favnart', 'aslushnikov']
    user_ids2 = ['id121389', 'id628380', 'id121888', 'id281818828']
    user_ids3 = ['id140480', 'batwoman_nax', 'maxim_solomin']
    user_ids4 = ['id13055', 'roganov', 'anastasina']
    user_ids5 = ['smolyanka', 'vpavlov', 'dummyfox']
    user_ids6 = 281818828
    user_ids7 = 185865803
    group_id8 = -222629774
    tokens = await read_schema(connector.schemas.path_to_tokens, 'tokens')

    user_fields = await read_schema(connector.schemas.user_fields, 'user_fields')
    group_fields = await read_schema(connector.schemas.group_fields, 'group_fields')

    tasks_queue = asyncio.Queue()
    tokens_queue = asyncio.Queue()

    await tokens_queue.put(*tokens)

    task_objects = []
    my_list = [
        -222629774,
        185865803,
        "148221339",
        "481398296",
        "470635261",
        "309069482",
        "251795184",
        "222938350",
        "274746427",
        "290175716",
        "138556071",
        "193894062",
        "501399313",
        "15843743",
        "422311373",
        "486127881",
        "59342030",
        "363031872",
        "225659133",
        "207114001",
        "26881495",
        "4097132",
        "29716052",
        "152765528",
        "454869169",
        "37868685",
        "402485561",
        "12705300",
        "481274223",
        "20928711",
        "342650562",
        "230034756",
        "892108",
        "92134355",
        "162883692",
        "45912937",
        "501262186",
        "486217299",
        "154401360",
        "36890447",
        "343705400",
        "164026349",
        "476829770",
        "358743118",
        "23178964",
        "9185979",
        "50792945",
        "65906195",
        "260691492",
        "145859385",
        "490480543",
        "142502500",
        "173093088",
        "486830865",
        "204380223",
        "369737839",
        "36570700",
        "459089261",
        "396352138",
        "398088080",
        "186941229",
        "500868899",
        "4726097",
        "286335355",
        "326813377",
        "197941006",
        "249011957",
        "500854555",
        "887801",
        "236547416",
        "87555059",
        "40209887",
        "298945754",
        "279669186",
        "438207902",
        "57582709",
        "24925979",
        "217508003",
        "7955538",
        "475472494",
        "495260506",
        "434300985",
        "94412988",
        "455861978",
        "216826772",
        "343247876",
        "188696434",
        "228494608",
        "464348364",
        "405785344",
        "436165494",
        "328831484",
        "24593269",
        "240054028",
        "338128895",
        "51439995",
        "314725741",
        "487086330",
        "478448245",
        "31768604",
        "11478285",
        "450101623",
        "223699445",
        "249869193",
        "480776160",
        "43518089",
        "416088145",
        "272374234",
        "422190235",
        "184870541",
        "162525695",
        "42048063",
        "34792743",
        "14558160",
        "51346007",
        "501258818",
        "416284905",
        "170003183",
        "51054764",
        "99801656",
        "440813643",
        "501217009",
        "433717755",
        "499591497",
        "403892574",
        "368797864",
        "480154",
        "361922902",
        "27543884",
        "62965042",
        "139167179",
        "46617747",
        "196146619",
        "1387180",
        "23005281",
        "23063622",
        "233708684",
        "100173997",
        "239130196",
        "424285871",
        "55092507",
        "162944243",
        "321895568",
        "497994461",
        "487235964",
        "494211050",
        "427479316",
        "365812280",
        "29092275",
        "212243281",
        "307033982",
        "161722878",
        "142960991",
        "245429932",
        "59601280",
        "162690487",
        "501228767",
        "243027168",
        "1570015",
        "162428536",
        "46948084",
        "53795846",
        "453234346",
        "22530517",
        "102695052",
        "13683541",
        "16178595",
        "184219147",
        "187778798",
        "400948040",
        "483859915",
        "62800878",
        "118550876",
        "412354913",
        "158032795",
        "138403635",
        "501197172",
        "11783752",
        "218266840",
        "244048934",
        "381097010",
        "85320720",
        "472809081",
        "144531373",
        "339838258",
        "500762885",
        "281998115",
        "157689869",
        "6728836",
        "223173113",
        "209134942",
        "191005145",
        "15624878",
        "97839790",
        "60626908",
        "90197273",
        "32212910",
        "201070552",
        "64531309",
        "344722057",
        "4188155",
        "60280404",
        "15585487",
        "293169011",
        "1531590",
        "27325839",
        "495272754",
        "296923189",
        "156256316",
        "298680428",
        "99702759",
        "499472950",
        "14608183",
        "132510008",
        "475029747",
        "75991734",
        "469609946",
        "210869880",
        "18423135",
        "47471243",
        "283333488",
        "63035268",
        "31616795",
        "67771914",
        "216202198",
        "475281589",
        "284485232",
        "234913463",
        "246679295",
        "14180161",
        "115220329",
        "171129908",
        "59690500",
        "168620937",
        "449195818",
        "501166598",
        "102034979",
        "411331604",
        "110336341",
        "349147029",
        "330910337",
        "378445583",
        "18162306",
        "116587075",
        "431333574",
        "2712563",
        "381424347",
        "497758284",
        "499510118",
        "205088768",
        "472754315",
        "496606226",
        "434441225",
        "80668981",
        "147011994",
        "103590515",
        "427226717",
        "310877119",
        "469503481",
        "500845974",
        "474765078",
        "32291964",
        "111677819",
        "96126403",
        "15435874",
        "158848595",
        "333585452",
        "500478265",
        "157754239",
        "474736245",
        "37672283",
        "488395034",
        "481600103",
        "15868396",
        "94704900",
        "228438213",
        "29226401",
        "11895199",
        "117249145",
        "24208732",
        "323213050",
        "432056670",
        "211653547",
        "58810287",
        "24309286",
        "12909904",
        "499659137",
        "6429645",
        "471079361",
        "26438269",
        "273850691",
        "170182448",
        "48681",
        "49825805",
        "133283670",
        "456519858",
        "254462558",
        "19510056",
        "8362693",
        "501184216",
        "272028248",
        "468307724",
        "274351531",
        "45277756",
        "395770894",
        "459403898",
        "301425562",
        "53624886",
        "143084108",
        "365713774",
        "19288280",
        "8542746",
        "498984893",
        "57168875",
        "301923465",
        "78813145",
        "159608034",
        "269202349",
        "1591747",
        "395014969",
        "441431883",
        "11533343",
        "444678124",
        "88510519",
        "404919589",
        "416018037",
        "479055169",
        "337918367",
        "443724893",
        "259669699",
        "339521012",
        "178642676",
        "163287332",
        "501336899",
        "408485745",
        "61942042",
        "476646532",
        "472500542",
        "451559476",
        "432172031",
        "452726660",
        "461691802",
        "350475369",
        "341032537",
        "253051289",
        "383914449",
        "441583545",
        "418326754",
        "450022776",
        "464651825",
        "91392751",
        "273374482",
        "498235435",
        "409356007",
        "498160684",
        "197484729",
        "169362244",
        "358908221",
        "444890029",
        "500342773",
        "85659478",
        "144196134",
        "141202815",
        "273198045",
        "292048678",
        "386648412",
        "478433172",
        "119029346",
        "206003574",
        "460854484",
        "194030990",
        "244083368",
        "72103023",
        "501264248",
        "157451443",
        "483387097",
        "225987956",
        "453481529",
        "161682725",
        "91795066",
        "207293489",
        "499604748",
        "376466946",
        "489106187",
        "138176231",
        "501422485",
        "496914856",
        "79388067",
        "348713642",
        "481508561",
        "329023451",
        "497044938",
        "500627408",
        "476893528",
        "375888547",
        "248138885",
        "364927474",
        "283502990",
        "186604732",
        "186752381",
        "295600501",
        "169688044",
        "371420500",
        "373951903",
        "382893140",
        "50524760",
        "138858722",
        "450762936",
        "398102324",
        "359997621",
        "413162857",
        "268203516",
        "216567516",
        "423223485",
        "331388150",
        "334600471",
        "351934037",
        "383073874",
        "488852518",
        "494802603",
        "239114346",
        "500014661",
        "449283997",
        "497105809",
        "138760110",
        "316631709",
        "193318356",
        "358593199",
        "483564149",
        "144661557",
        "314101656",
        "447516492",
        "443318578",
        "172640723",
        "174796690",
        "493428709",
        "9340292",
        "27382548",
        "501382971",
        "496649819",
        "483918113",
        "501361114",
        "457227203",
        "476022744",
        "351768868",
        "497887472",
        "451860593",
        "31308180",
        "427462352",
        "259609645",
        "484448687",
        "310482497",
        "329168773",
        "218720059",
        "106136149",
        "309344000",
        "280649930",
        "448014123",
        "433233128",
        "482650145",
        "461462453",
        "19652402",
        "220575838",
        "399060",
        "8064566",
        "391630712",
        "470488832",
        "421032312",
        "496080198",
        "467433349",
        "194217140",
        "495933479",
        "415866908",
        "177329695",
        "372973083",
        "8564081",
        "495769358",
        "494982960",
        "28712504",
        "211296362",
        "19383078",
        "53427476",
        "316022687",
        "88910706",
        "6280067",
        "500774715",
        "72554441",
        "192681772",
        "257695079",
        "6174869",
        "319776741",
        "375001860",
        "88226205",
        "363511224",
        "401532377",
        "499108171",
        "253620063",
        "372647951",
        "499345257",
        "501305718",
        "75992999",
        "304297989",
    ]


    distributor = TasksDistributor()
    task_obj_vk_user = await distributor.grouping_tasks(my_list, 'VKUser', fields=user_fields, coroutine_name='get_users_info_by_vk_ids')
    task_objects.append(task_obj_vk_user)
    # task_obj1 = TaskObject(my_list, user_fields, 'get_users_info_by_vk_ids')
    # task_obj2 = TaskObject(user_ids2, user_fields, 'get_users_info_by_vk_ids')
    # task_objects.append(task_obj1)
    # task_objects.append(task_obj2)

    # task_obj3 = TaskObject(user_ids6, group_fields, 'get_subscriptions_of_user_by_vk_id')
    # task_objects.append(task_obj3)

    # task_obj4 = TaskObject(user_ids7, [], 'get_posts_by_vk_id')
    # task_objects.append(task_obj4)

    # task_obj5 = TaskObject(group_id8, [], 'get_posts_by_vk_id')
    # task_objects.append(task_obj5)

    await tasks_queue.put(task_objects)

    await worker(tasks_queue, tokens_queue)

    # TODO: NOW FORM COROUTINES FOR ALL OPERATIONS ALLOWED BY TOKENS, SEND REQS AND INSERT DATA IN DATABASE


if __name__ == '__main__':
    asyncio.run(main())

