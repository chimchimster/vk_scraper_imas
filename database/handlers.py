import asyncio
import json
from typing import List, Tuple, Dict

from sqlalchemy import select, update, insert, join, func

from .models import *
from .common import *
from .decorators import execute_transaction


@execute_transaction
async def insert_into_source(**kwargs):
    # Для тестов
    session = kwargs.get('session')

    lst = [20189841, 181040320, 99178210, 557001824, 202345380, 116388568, 741321670, 345357203, 459684793, 194540240, 634509985, 741417614, 637597221, 160960850, 739389165, 536283791, 639300301, 196536887, 741376631, 318152088, 741516711, 211189155, 38460702, 636881443, 729753192, 520576370, 499870150, 389711582, 190671327, 739878170, 49455116, 229971161, 153453121, 152326353, 739715714, 611491936, 462513914, 385655556, 740224154, 715953538, 741324080, 201710387, 502970767, 586521742, 1548709, 523987975, 198375773, 277284029, 496102179, 675500878, 492289605, 212060637, 73749528, 738097058, 264880669, 669731701, 49706638, 737490386, 151375311, 1202211, 122512584, 518025512, 617994793, 706262485, 739047179, 477855645, 180578684, 49742102, 306252581, 72889844, 323613421, 626997422, 218701787, 404629195, 13770354, 542065316, 510741930, 601340387, 335305662, 550744982, 54741798, 579379437, 710137158, 658843916, 158172198, 290046260, 668755504, 360441257, 741508887, 741503800, 633986980, 618847491, 5735637, 629856311, 703818110, 158531482, 153409013, 119992867, 723280179, 670814839, 60841304, 741270870, 473271760, 16230757, 40113969, 386962428, 583769090, 350659509, 393329105, 712796408, 321922553, 636840635, 741541195, 233287908, 35068431, 735603319, 94656092, 179722045, 717485921, 532822153, 376610297, 739044225, 647006132, 556061414, 738942847, 356456789, 221025124, 246991546, 37023464, 637029864, 32106286, 738068330, 715676184, 676296065, 172756795, 694636283, 312903355, 100269193, 702790095, 689106701, 653807533, 146094097, 694184681, 740926062, 332133724, 741528040, 551569462, 170361452, 559594530, 498610012, 114736590, 271975257, 124894982, 316769817, 31053274, 360646013, 593025681, 273898442, 146486782, 88557813, 453136875, 136942582, 693348884, 593803383, 536634499, 417377082, 643645182, 502891510, 95180580, 135181716, 11608014, 268439823, 228303065, 498279866, 500315982, 98668225, 736582572, 346110007, 656819894, 376854, 739597993, 665385118, 737203171, 125232341, 80314644, 697701377, 344890712, 338377816, 741543448, 490332262, 613973360, 741281177, 12792943, 69938822, 385823352, 96827987, 613492801, 381965673, 133526764, 664408302, 685044697, 61330805, 738709202, 384306330, 195164861, 185431564, 679610105, 566350711, 741454082, 660786664, 741308362, 561619992, 51760977, 241554816, 119376771, 626987240, 731676020, 544496312, 285031890, 385581652, 134257334, 82647696, 741252198, 360387439, 449643329, 691153463, 85372002, 12838286, 92299852, 569437399, 707883221, 302414988, 664542496, 166932407, 738813550, 656464159, 723085789, 2945527, 737567126, 741155682, 247884635, 738976055, 591290110, 484112356, 694138997, 731162295, 525306075, 12277128, 242505783, 17935651, 739569828, 733849297, 733908964, 741503624, 548232302, 118465697, 195894067, 268025113, 492142390, 741579001, 33911319, 616291549, 244906011, 360313381, 723456340, 696322621, 740756361, 16860746, 294506045, 654923707, 693632748, 6267032, 634613257, 480439147, 622246876, 670725497, 701047873, 568711523, 733862292, 733891404, 733838984, 710712190, 64108183, 733925617, 733882288, 84414055, 739377224, 349955261, 696007223, 106683666, 741580738, 729820165, 98993551, 667916296, 741592200, 496259690, 729897254, 151619570, 195111472, 608999101, 151952785, 109275250, 364592512, 452099629, 200350485, 733840345, 711471482, 58602016, 733876921, 733957245, 739566095, 41128715, 369280350, 741566476, 733868943, 33011232, 291672720, 449251454, 723885311, 733867693, 732789598, 741298303, 354387497, 598185477, 220899077, 718084702, 127469874, 699526025, 267989058, 698658910, 309908426, 733854054, 627447322, 741549811, 733912695, 628990300, 37405809, 603672279, 165972136, 576366824, 676138859, 664793094, 507982870, 287978624, 501032951, 710340680, 634550324, 700563154, 733845118, 733759112, 741385302, 734414795, 699723115, 733882223, 499884384, 733902180, 441049073, 100349382, 1758152, 569127816, 113317034, 632216343, 307278780, 208619233, 4449743, 51345975, 707606700, 689021464, 347961782, 106305372, 740992243, 566460373, 735342329, 707402511, 321878689, 698286215, 639961383, 719088835, 493533920, 29561039, 222801381, 714972377, 738878962, 226598836, 1363245, 292337912, 74020034, 387089178, 414624112, 737852042, 665026527, 63782579, 97130949, 484380730, 701379537, 645044035, 135372868, 741033333, 618397499, 732257542, 428343346, 118758, 717009720, 63498818, 614057751, 346401352, 121708824, 741507784, 331130621, 741560010, 132446832, 554520644, 621853651, 175077572, 30167301, 268112887, 117572653, 644425527, 741589806, 158988159, 487632173, 217522574, 221569116, 325549366, 218008194, 12173444, 462870026, 741582515, 11986416, 134847153, 133168430, 21093350, 703114973, 22652976, 227098288, 614134241, 741588696, 741570375, 214263180, 343407015, 741588406, 645950811, 116670623, 106100422, 82275753, 540599203, 741574839, 688112913, 573375951, 75018175, 741587962, 723534846, 35377783, 78084417, 741587709, 296808329, 741569653, 245469361, 2250811, 741578396, 147697982, 201712661, 740940813, 210540954, 61216121, 24097582, 741581792, 741587006, 654893721, 311278007, 733702695, 729822018, 741015924, 126498128, 200962805, 200198989, 231009816, 152537179, 54265858, 741586462, 627633011, 369396914, 314082259, 552644376, 64422986, 50511611, 741541740, 741586189, 643508566, 741585936, 732786927, 635984213, 68743720, 460936871, 267454273, 321258376, 151559504, 434589340, 56750, 673683725, 92011744, 87403775, 650077730, 627024784, 741455440, 107874765, 134866200, 52001657, 24908655, 710467648, 739827554, 5299133, 735434264, 139753333, 458299605, 17938672, 35940581, 714944660, 401781706, 6149979, 73235210, 657671575, 194890765, 551478448, 11233700, 68517812, 89720886, 636957799, 74549219, 25275687, 336634204, 156372174, 563119307, 712303128, 372741783, 730687016, 24420679, 141581296, 740292768, 384122754, 346185114, 643152764, 66927190, 33703187, 660306672, 31107350, 555732332, 5399772, 739168470, 111379941, 32881623, 206186478, 678450736, 154331789, 72007890, 189977420, 353398955, 631753692, 551381288, 11308845, 189530666, 351927599, 625245567, 741412067, 41580035, 254628766, 741095967, 537250810, 28527774, 501840310, 87588122, 409454185, 358016651, 538900695, 160172190, 62965470, 185554568, 125138369, 723152934, 323938783, 741578628, 107759081, 66253695, 210083142, 741472601, 518782341, 544382844, 12844728, 683037237, 5500209, 567426370, 220340426, 186908130, 4251953, 9465943, 738770783, 244336507, 15742261, 197807635, 45845396, 588818458, 737318889, 689958410, 59140217, 497984930, 68680181, 159114804, 289255912, 16538470, 22179362, 170958607, 199104889, 31051224, 207461211, 687950154, 21834578, 699603111, 692642067, 20901673, 551211757, 571425541, 717992154, 482352221, 551883823, 535778098, 740140029, 326302516, 682291123, 8101962, 711743467, 113132572, 558355629, 66211093, 60429262, 531034464, 655579837, 740925167, 561283229, 5014550, 233375561, 372387331, 338284836, 247300951, 212957069, 740904944, 636996803, 668039453, 462063782, 625223154, 737710748, 670302254, 740532745, 202697405, 61711876, 142325249, 451922227, 159575295, 496652039, 17123376, 600439704, 514231077, 240797336, 276795939, 30532720, 739213551, 741122270, 4140725, 170748664, 49360241, 688187631, 737431904, 486905159, 152025169, 733885907, 10691351, 136007621, 232881542, 525740751, 7834121, 444113763, 120935020, 153855293, 226244860, 82839094, 696743903, 464665684, 153923242, 190406048, 572272774, 203515568, 687514233, 442702734, 450286321, 709706312, 303356513, 71394502, 240604716, 51037166, 681999166, 602761697, 443789797, 78585073, 308824549, 502227751, 737569138, 603042388, 658020769, 132183283, 335080803, 416652629, 276191592, 704072117, 357823206, 571720466, 305624771, 623153975, 720278682, 41744940, 706907020, 6635020, 518226122, 734414797, 418183996, 409939038, 540660766, 488306345, 512748942, 693213929, 739085834, 666929670, 520301967, 103856383, 614332429, 709728782, 741567912, 191609187, 663974975, 23463515, 565442821, 406282233, 434764566, 32180524, 276959783, 134829297, 481243686, 513941617, 675404383, 166385851, 741548389, 327451735, 3911369, 77671794, 29066679, 11038366, 719113116, 418412938, 670798882, 713228728, 48927617, 10904019, 159215301, 75305451, 362680106, 186582597, 614325594, 94413250, 669030326, 139466780, 3806713, 741565493, 481836573, 150324178, 3009709, 729843779, 580562560, 373846499, 27454564, 722905174, 567678435, 554535260, 676862192, 739706823, 425481719, 712975743, 639819488, 174030848, 640237123, 254235885, 710872641, 19248003, 160263070, 335959913, 143711899, 741564650, 741530517, 521586634, 520352496, 18123597, 20448435, 273320294, 325897936, 77582021, 19887779, 70405835, 140213479, 242425693, 23545281, 714289168, 75629890, 630486622, 711539679, 176755417, 567859761, 739582189, 156629011, 87302823, 321043626, 68265262, 187110660, 205139027, 43863249, 359144238, 28508080, 669886118, 587763159, 179212011, 341640259, 616886206, 407144933, 555465773, 382407229, 673126056, 226707988, 732962049, 565553395, 114293573, 723437384, 141930018, 197349062, 5610963, 737450141, 9702636, 36023772, 455595776, 522040533, 19592965, 71164557, 693413074, 677359852, 221340412, 43445866, 737262460, 343673475, 741559604, 382669286, 242428317, 71430766, 12982663, 166976956, 182072976, 414603074, 563223436, 693619480, 74827639, 31078157, 640453828, 621443859, 163318557, 191944506, 741495352, 682846558, 493735906, 153560647, 39046583, 729468420, 4421958, 326337108, 12150903, 295467171, 711757610, 641901777, 470666496, 4456990, 342501819, 709753665, 741528483, 671517641, 671043830, 116900974, 557867246, 715349779, 124789657, 734399175, 319872538, 555239747, 435568626, 22332110, 741522850, 45787263, 223194703, 162429114, 2985767, 732815605, 88807100, 24840564, 588361025, 240192347, 166006616, 350229897, 4887636, 25596747, 198682136, 662515696, 713281157, 38442384, 30831109, 297214160, 720790161, 629016560, 239569106, 132891443, 732725370, 85955871, 86986784, 690872487, 570737823, 380452436, 77216802, 61025221, 512088314, 95944337, 732724795, 734882646, 58889938, 114428373, 156929566, 76669775, 9876038, 578477642, 585259649, 655104506, 30271843, 116512930, 505713897, 741420517, 741551468, 523514418, 732724224, 685569245, 737942433, 423232641, 87636913, 596161584, 39428472, 322191897, 525603926, 739764324, 741550259, 132493557, 216403462, 714770975, 162183244, 140025682, 83908276, 580271304, 554831345, 732721938, 730380826, 120892264, 552154942, 55643501, 54331033, 730190375, 575217081, 141022269, 690504185, 526667568, 679797009, 183708101, 737319830, 326696503, 649178237, 738740717, 271574407, 717042416, 11526229, 14279021, 736369701, 740462603, 97264966, 316516504, 313946332, 72594142, 741457422, 2142973, 87927258, 356728114, 722104893, 671195903, 71472707, 686741974, 679048105, 176862938, 661243404, 23634295, 42187693, 65114456, 24891185, 5087845, 9250165, 29088876, 237940345, 5303272, 710583636, 4423043, 741545166, 146473154, 728909376, 133261401, 45151674, 44050986, 590880199, 179617357, 76203365, 168316111, 289592240, 265221660, 433850493, 717131429, 736415410, 51789578, 100468803, 664842960, 694429988, 292196731, 136384079, 602047568, 303186566, 741611917, 54961642, 720190788, 234894102, 722750109, 455384508, 677654556, 636856133, 96109417, 141274077, 121221203, 674673588, 367482053, 560286137, 252692682, 5342465, 152733826, 545569360, 132867411, 313068368, 6180779, 424424, 558103578, 75627496, 170266040, 286702331, 451848453, 873127, 164510998, 688546969, 739282987, 463473812, 701555936, 380991972, 709245095, 737220810, 353132968, 709968212, 710103176, 487911442, 624498757, 666425025, 141047949, 626056340, 607158316, 532391643, 634203263, 4389092, 731192752, 137142640, 411434427, 169840562, 741519950, 667120825, 348777233, 733675200, 461330230, 737221428, 649184111, 655670108, 736003049, 688930881, 741499081, 741294168, 377485158, 682156885, 572677399, 163981288, 139554030, 23220663, 739573428, 187161686, 740342638, 94365177, 733167843, 135134751, 719174691, 290003074, 615759524, 668366881, 66156141, 355887531, 655704484, 556535210, 5329980, 605004150, 568592171, 625569031, 5521129, 564241893, 93343326, 193773781, 424614021, 116744376, 384132878, 707555657, 511592036, 680619121, 721331855, 609775495, 585309905, 740945351, 609421071, 741069822, 637974120, 618114650, 736004740, 722072740, 683486497, 39359538, 737221097, 634825099, 261879238, 228784919, 26016454, 59918967, 392150425, 822177, 169508412, 193903154, 22801891, 244959713, 672719946, 741600819, 352417477, 300112407, 68016916, 646658, 347287624, 709168727, 694098949, 734782245, 152308287, 200526589, 80932254, 618078397, 218302693, 699848427, 84130981, 335091972, 338136902, 7364622, 625803920, 631913030, 741614272, 708609008, 324225623, 100617022, 403343784, 504315641, 615712850, 728348800, 655813714, 627057522, 739015007, 77970675, 458365512, 680066686, 499065937, 730274834, 566856400, 42351598, 729685279, 679160283, 8401980, 313693035, 568861720, 7588613, 715141495, 252063908, 617736557, 2786315, 156050561, 529963137, 94924152, 24711136, 139383588, 132891554, 569456077, 3836790, 548310746, 592603702, 107244103, 455549544, 740085002, 244538688, 134193381, 740713025, 202098078, 4681293, 146286449, 620147238, 618008944, 739242237, 508438013, 614788393, 669643035, 677612390, 126695286, 25281863, 311349400, 347271826, 651564889, 654081789, 423082692, 17241234, 638290091, 612459056, 27381254, 448004668, 652923985, 188388249, 489523954, 616316563, 15369081, 414641501, 711222000, 24348559, 529986885, 733520335, 207745966, 406585522, 1398503, 174662213, 248558081, 2769912, 652037676, 633949407, 361470520, 12011896, 374976884, 549445015, 10592940, 623346832, 71202007, 681349635, 446123972, 589992429, 396694928, 180844116, 471533724, 375116251, 512703, 616010523, 88655585, 519891924, 641888448, 600300314, 734862973, 192647654, 56646560, 737222520, 710400133, 2853936, 497389301, 622451676, 40636884, 281813314, 362905439, 429128564, 705786740, 720821144, 517145589, 92148548, 250398830, 611124055, 82180670, 445853747, 740714667, 715274591, 481273595, 620138420, 711591068, 581498997, 572901277, 657694491, 596551846, 490153777, 740627190, 627185750, 87397171, 343506170, 22877490, 497998575, 712128803, 416584420, 738696494, 178392406, 66918528, 749099, 729415952, 715741560, 666680444, 739476024, 118448973, 668668466, 3673877, 734685615, 13552697, 739222461, 569686049, 647071793, 672745098, 700103640, 741315300, 676031337, 666364074, 134799525, 658281589, 50507851, 739824289, 467076826, 739726938, 3601299, 678297959, 649985934, 2140151, 580491082, 254683102, 708246790, 741427422, 209197338, 695686047, 43241455, 2856750, 652948141, 384954977, 714726770, 493024814, 304175570, 570525390, 91102423, 698808995, 64663119, 696577621, 273296124, 741270330, 63187285, 100348189, 741315134, 114421166, 317759487, 33651602, 316701477, 3063486, 498804999, 608325529, 741598689, 564387048, 741609244, 484899208, 504773247, 741394725, 687915752, 211725794, 689733551, 76546444, 226216843, 702856122, 227331323, 650752405, 635190528, 23131362, 246623469, 278667481, 102493276, 551437510, 705002334, 82797331, 12765886, 140220810, 519530566, 720185501, 711237079, 730587753, 676745997, 14017286, 582312782, 355291022, 523866491, 164154726, 672905237, 44293428, 549285228, 737227441, 691497930, 526857050, 711524533, 280096816, 58441314, 248709034, 123092794, 736552082, 697135555, 241712105, 682424454, 737223042, 737222666, 658973105, 740683537, 553146345, 29219363, 739887734, 730682818, 139190128, 251713699, 1302647, 144039950, 143982953, 655239118, 710639660, 323859305, 674335455, 171718839, 673787689, 741611705, 376043445, 5423948, 95404058, 373824000, 52372261, 739187704, 103783916, 1041566, 741612382, 675737731, 59250448, 139275450, 173139110, 300598081, 11044255, 680458924, 639111187, 71594347, 741611076, 225632428, 711874608, 714221305, 741155059, 728776022, 48426222, 9009352, 281721434, 108362705, 741606616, 740004391, 736346825, 315846658, 218695480, 261098422, 225073021, 11686697, 48318624, 710597356, 391217750, 78186321, 705673895, 655670929, 631443075, 661848538, 165281428, 161754816, 739052762, 718212239, 277966407, 651512627, 561892984, 400938299, 553616917, 335876115, 682165700, 146413976, 632450034, 637960931, 695323335, 661332357, 210578849, 305571241, 585217682, 732808663, 699545127, 455775782, 224521482, 485874317, 283714557, 251848674, 453716179, 699636254, 427252533, 713812309, 627459539, 2628065, 112525342, 160103074, 591483547, 624406487, 740600275, 585631184, 662168823, 6414312, 558513015, 230531095, 5609842, 718449157, 645277501, 736296352, 729809855, 737222835, 677052222, 711380743, 738461693, 286409883, 673235477, 4857084, 518606965, 562883655, 76725387, 708908344, 33672115, 710997512, 64706361, 386131197, 741591467, 741470041, 506188888, 15868392, 634916793, 741421842, 578094860, 96131715, 620350133, 670313282, 54784731, 647277889, 740221436, 647404947, 600939631, 741309990, 679581034, 740769562, 624778719, 739894546, 279355196, 225596190, 642913938, 375656947, 192160840, 18405942, 17867243, 694499760, 740900864, 256612482, 480362499, 120364114, 741424237, 13103387, 579223872, 716788017, 376076133, 351476762, 38677944, 464845122, 736199055, 425488596, 741604006, 170507188, 318116285, 563650646, 652768094, 456906548, 616318749, 135859155, 668096744, 624820572, 59053926, 32854831, 115814478, 613486370, 72831809, 679859589, 741593576, 58499522, 730079367, 2323949, 156814281, 16174697, 653788771, 615780863, 706320491, 740087844, 737436122, 736824361, 72872413, 654961760, 458210056, 140080034, 311358895, 4118294, 664975793, 704749107, 681138940, 612322567, 303064746, 732267858, 729366827, 728594562, 680676333, 722460342, 9019828, 9427945, 221906552, 734869743, 27381136, 729362158, 462419530, 131689824, 21838104, 619265966, 392143686, 175088489, 647873650, 237669950, 590098680, 427973263, 182456624, 617760616, 704933911, 439327881, 498116899, 442753512, 718453728, 709748147, 621971910, 658609652, 662308667, 534006602, 645816018, 476425238, 512113599, 708013571, 156302865, 172264095, 722111287, 740777827, 13483742, 674767364, 247518571, 683330372, 721303926, 638269677, 176769659, 741543378, 26652252, 679974915, 35828297, 605031023, 741600828, 650691953, 735699606, 152242710, 668383780, 232288579, 624715367, 470418169, 578984977, 730209898, 653062421, 737127954, 735879467, 709380806, 692703554, 739008275, 499938676, 643338623, 671674109, 682440443, 607477323, 340292424, 408202242, 675521577, 163404439, 737327582, 606123260, 6446944, 218378554, 448106248, 9271832, 302111092, 955185, 741607161, 21350768, 373493245, 486606930, 183813085, 100489599, 5688465, 520987759, 194792988, 56030898, 167802247, 650475858, 692452460, 740661608, 404249700, 653187916, 594160715, 324439041, 457802597, 596921824, 739198112, 734202558, 615376783, 717426157, 669104385, 275521005, 707252496, 311443159, 737984465, 735298443, 556030002, 21581002, 491722430, 154778561, 520459469, 497994584, 352305421, 657105480, 734582021, 707725734, 663358185, 98125164, 703529101, 647215428, 70919209, 175442491, 648805327, 740939891, 222038934, 565982695, 707829700, 720003954, 644910652, 626579554, 175479168, 9389281, 646827817, 160435776, 701314606, 740768531, 75379586, 387515806, 133968610, 665385879, 28446766, 451591469, 561265621, 97943329, 705042583, 188062017, 45305840, 5418935, 641166423, 237110048, 705765898, 171694868, 601688732, 366367096, 479671646, 504995094, 134451490, 180811002, 721051243, 721466354, 738811547, 485649119, 24527749, 389585898, 539609985, 719949384, 154473806, 289512696, 653549747, 317056262, 421484612, 677606583, 741379748, 542616601, 403448395, 116427577, 696931953, 681392137, 507001386, 700766615, 548413186, 546266431, 547885876, 281475138, 740391599, 58045555, 716762764, 741171592, 698987531, 135302277, 699681485, 578621770, 710386660, 103698900, 717389930, 741515938, 705054935, 655814932, 61681014, 591145479, 663420173, 691543786, 117011046, 92560586, 739059283, 732377611, 515005915, 295205317, 3136451, 709679564, 737476418, 695182821, 518927345, 612126156, 610412727, 681854678, 705338486, 501638190, 74033046, 735624396, 162786792, 739924461, 616232985, 364291978, 733473294, 738111965, 118166943, 503358207, 5364957, 694805884, 537090971, 597532801, 26052185, 168555499, 739903696, 643708348, 741595274, 738777162, 189104764, 524374855, 2259284, 551740196, 607040922, 648458455, 437453714, 246459369, 193095002, 568900660, 124808129, 678163479, 62238691, 676031340, 687116196, 82321222, 580139671, 398862611, 219452594, 373767599, 15625617, 132127247, 700891707, 602074605, 484706840, 736281537, 1205540, 547534601, 741562984, 276317232, 156763060, 462031199, 24279223, 623094788, 563296272, 161318662, 63752025, 638027241, 170612210, 362235762, 740905860, 741597020, 307092091, 543741149, 731681010, 672014143, 515124016, 677879759, 93641725, 719847572, 262039607, 550076730, 519541898, 661053371, 720546749, 736547144, 732110380, 734057870, 37751789, 190942255, 547600775, 741606258, 709729032, 2876399, 630421390, 683909858, 588015353, 9902120, 84537434, 89354595, 331808423, 730864114, 446045887, 172762169, 336580134, 189373903, 338597016, 442073610, 712726466, 283658477, 736946783, 636182679, 523668122, 740847438, 45165531, 616193305, 739822365, 292643327, 607445034, 135188606, 379044907, 723192265, 218888415, 151604673, 636182688, 709484816, 227114648, 626060922, 509121707, 709623515, 29462550, 722756111, 331903428, 8554055, 688899547, 539542563, 681710116, 196205286, 649603509, 497958664, 715481081, 369110791, 707591894, 160379015, 676367186, 637215841, 555625889, 741587419, 333623275, 206686539, 407116, 707055413, 385459458, 30316220, 731636835, 517571026, 31602641, 708471482, 703782484, 24551167, 646313482, 25731797, 514756452, 720431781, 456769571, 224358082, 664741054, 342517717, 164047812, 733283699, 2415228, 603506206, 730791776, 137259649, 409741387, 319191326, 136799541, 447968816, 75387193, 697826176, 711507019, 605777144, 734376770, 716176078, 662804384, 64615476, 431770289, 678546961, 71955728, 484337976, 151590110, 734466242, 90139485, 137452919, 418929657, 694585124, 741467111, 10479873, 740097151, 661646031, 679353002, 478095351, 650138509, 51517974, 711129422, 158135677, 672122037, 586169491, 690901637, 666728558, 652559754, 721871857, 694489867, 732233952, 507298754, 739585934, 31146804, 23290506, 708164225, 686634945, 621825219, 327120854, 442099253, 29585753, 306434766, 191362019, 646719036, 481571823, 364699400, 421190919, 682269476, 224901073, 572423504, 174166353, 168841590, 723500048, 377642505, 644079525, 538128103, 77648946, 58484549, 729832706, 502960245, 195829525, 124430176, 137584447, 614995719, 540941426, 417614635, 717506740, 84341090, 26978721, 321616879, 653397086, 283887252, 634687455, 140007202, 470600391, 107225889, 671380521, 509174180, 22168590, 359165748, 158753623, 146404794, 457498698, 61802232, 1254044, 225816905, 739461663, 635869970, 707119844, 1861785, 739927021, 366354793, 274557891, 167373547, 278464944, 655439371, 734100410, 72170718, 681619151, 564591950, 680632697, 509586870, 522136455, 237401282, 390831576, 700204087, 732532529, 16964640, 739439825, 734669061, 20551770, 466844896, 489545662, 231493846, 197586562, 741507200, 740940849, 711075739, 322907502, 166430353, 702819681, 30524632, 272818623, 730269753, 620937329, 132310974, 170827473, 259823515, 547924997, 35447270, 153675392, 662082275, 17360765, 604109613, 667746480, 269774304, 504884634, 664952745, 330680070, 69437859, 140292411, 99379310, 200278556, 638729138, 46417428, 5273482, 741395228, 738625924, 741393778, 695824258, 707778205, 298438808, 596153356, 697115947, 699395337, 645038604, 289940967, 740399141, 145045091, 132399243, 11966997, 359168170, 124154274, 670225319, 303149233, 582610101, 644225518, 220246475, 214469090, 567343907, 194891585, 41139978, 656350265, 709992501, 741392731, 211222084, 696039051, 543179168, 715595625, 636682370, 95049495, 741390227, 59440081, 513712778, 452708249, 29378014, 631905924, 737809549, 671081307, 741586579, 679660782, 22811345, 741453508, 620775858, 623231321, 728442252, 152100122, 740942182, 124178033, 32728265, 662304540, 573007770, 457132182, 253242692, 146033885, 683972378, 729132066, 134587558, 364619067, 561884897, 150687251, 740295599, 320784503, 570945044, 92474709, 716165839, 570439233, 620276394, 741606632, 673531505, 740921391, 731087069, 607615290, 705287364, 730136423, 525962061, 340469633, 539940104, 27621346, 197153438, 637105037, 691741667, 589226893, 522441927, 227576197, 666184212, 596523828, 641793011, 132073339, 353344110, 552441484, 583992038, 270416198, 465807418, 322223628, 24261352, 172817659, 709308814, 577628893, 618842819, 30218910, 244921919, 505985450, 741448450, 14264696, 691188156, 740142206, 589782009, 248490405, 641066370, 77232935, 646572258, 312239370, 95492962, 655359244, 275072486, 585561867, 692381489, 584408250, 318204917, 741163412, 656021294, 713573557, 100088282, 690311416, 431486579, 634867317, 739483004, 527020524, 194430984, 737069484, 466167336, 25698271, 318067128, 697351666, 693061178, 555209359, 696498997, 1830019, 601521698, 669993191, 21013536, 732637386, 528131548, 103104401, 140410844, 35182213, 6379815, 33796487, 739857900, 539012158, 55021819, 666087020, 697888228, 68948645, 669239189, 712490901, 656736744, 610827513, 356749474, 682575248, 674654676, 661915932, 737615113, 648044089, 491388683, 632427859, 140939408, 121579297, 740249603, 207403570, 602631028, 412566672, 31499, 741440242, 22656470, 40737096, 721101592, 688127345, 296817626, 741603591, 575853902, 591439829, 693936851, 339793063, 740145461, 69107390, 659652012, 488108902, 633135694, 730203770, 636974013, 680841699, 532744485, 682054604, 4930109, 669093453, 591771667, 470254413, 729898726, 647631646, 66909216, 437590516, 59149140, 538427993, 426977279, 494179811, 369133810, 740436761, 664124038, 57915421, 581149887, 575857304, 695573387, 65882082, 733756105, 225535503, 250873853, 90693071, 710412992, 485843494, 181884471, 51938402, 679350824, 66110198, 709339591, 572269919, 600700399, 621888839, 617288394, 737042697, 184878824, 10747976, 652064099, 154304886, 161001604, 231985783, 662814127, 678464785, 696337743, 68545183, 679840402, 692340732, 564732377, 100045761, 8537751, 676190488, 455907680, 737366104, 6032634, 638809808, 741592662, 638613375, 213540115, 378551288, 30265614, 671991486, 699100822, 681536328, 234408, 561365976, 681947165, 703358709, 695280081, 6269935, 417960552, 597976161, 679912994, 135006873, 734846179, 138825442, 27659516, 261197083, 740579775, 739611835, 99491294, 605697990, 100033075, 354952582, 734851997, 635911420, 641948894, 664872506, 698898388, 337513798, 327959295, 134148877, 669889875, 6768953, 202224743, 735084316, 723454788, 19093565, 11320427, 607665885, 721124880, 1939626, 715376069, 19908777, 318022491, 64292475, 157860687, 138858693, 738847806, 346757, 565581291, 30370061, 210755260, 740922792, 537864536, 147393501, 741010218, 535115103, 42542514, 155005799, 734335802, 740335294, 688296625, 12090267, 162406602, 253725569, 314973027, 547127017, 27418268, 295284437, 678098047, 645800789, 172045946, 389749227, 546726319, 530929651, 198644106, 165644751, 626464878, 151901172, 184399641, 740348306, 498089762, 307671434, 361562694, 394246727, 139341022, 698341550, 451999333, 189425891, 487561193, 230569715, 677614443, 634333987, 694438159, 39618335, 601212048, 491642010, 2835565, 85458411, 739346209, 442697083, 89442596, 704210310, 647635146, 681145021, 321190819, 69438694, 633348330, 343055955, 111194294, 12423090, 682362901, 679077267, 195866346, 739615099, 587045519, 275270528, 515891756, 438468551, 719125812, 494131816, 161425023, 9607882, 711657284, 530331755, 679386751, 58742937, 479747285, 7052618, 709083233, 695276897, 491632267, 711469843, 710817718, 202528032, 710632209, 563088109, 43339488, 735447962, 220170182, 696361907, 438005844, 1974141, 740771055, 457825740, 180392942, 599103226, 220353164, 655217024, 409843116, 578200876, 597491122, 682657143, 121435568, 649519993, 662137755, 515208564, 460467853, 175401645, 741590955, 680958653, 711741768, 677344020, 83133915, 733428354, 734155077, 587414172, 723108106, 740656270, 720803378, 700297290, 124850366, 440467343, 624824092, 739092044, 594001069, 737940847, 129487283, 687514969, 543297851, 593702239, 17911094, 63252680, 33551035, 741118326, 690699408, 1787631, 444115411, 689661054, 714582795, 730239855, 346292839, 311658001, 730062238, 714978106, 677742370, 71083575, 641089269, 708915864, 683026609, 718411459, 81986210, 550334754, 301932999, 141454117, 99785762, 253224050, 5073868, 675820435, 551699984, 55942422, 533284448, 121386770, 311462623, 708215130, 708274680, 739921695, 435993866, 715060098, 451366825, 708738926, 691923871, 723338454, 692711888, 694167258, 713266740, 29709082, 586008222, 278529395, 160344842, 678286218, 173600637, 703390452, 111482997, 346068449, 534404237, 607993154, 660539605, 711346053, 39841375, 136426195, 588271444, 716689800, 280008554, 657000500, 408876152, 226010634, 666853046, 336804055, 273934649, 324758009, 11700897, 675971409, 740088962, 602211832, 671436019, 594515902, 475991029, 509107535, 705947190, 709026586, 63679782, 189188926, 321060808, 43339600, 664490789, 267655074, 537298899, 131445540, 518082863, 607125569, 715706709, 609519720, 695266642, 682076866, 529643040, 476184120, 466348084, 561174810, 469771946, 533941051, 738483476, 612914675, 169685038, 29818284, 674374990, 246501592, 656842111, 633879269, 738381950, 716148307, 140719158, 738936833, 738937996, 293890054, 738939544, 717604110, 260335927, 464412217, 738941085, 739703714, 721936493, 741495873, 740461054, 2167176, 737039326, 729151306, 605159178, 490869903, 739546639, 4329946, 599584188, 736692446, 188829875, 714978814, 134980726, 576279958, 150362352, 571244097, 5084662, 566351106, 741589874, 690168150, 686988720, 608313795, 737944048, 459872782, 88759970, 619815889, 710083686, 135722417, 20782406, 144495857, 712616969, 68425915, 655936950, 24837694, 642990567, 23810193, 62407110, 434231575, 17486507, 248693445, 159220529, 515507610, 54266784, 648794746, 350301297, 681924812, 389038988, 352807452, 117568027, 349522196, 698504762, 85210, 674033816, 330537496, 193309664, 817207, 503222290, 353364675, 577791285, 14249085, 27029279, 739364853, 738650705, 161563778, 735899352, 314004852, 543318813, 741387693, 712120889, 469556021, 599443015, 730624473, 139747630, 533658729, 164868372, 176906854, 106098137, 481810102, 739191316, 674224882, 105370705, 79219035, 465027440, 114947890, 740135782, 329195154, 140601588, 448879398, 44335327, 40312496, 713387847, 18482949, 114690829, 741471457, 544989681, 239352092, 627132873, 651328307, 36296558, 735372718, 172642160, 514856739, 75489560, 734975166, 538607, 580551780, 433154159, 731569877, 736631592, 25479409, 307788229, 55326912, 741531972, 738977949, 272405424, 435327959, 575331411, 190082574, 132017786, 733240038, 650119549, 702499758, 737347746, 37937970, 561055404, 9669404, 733082228, 560809947, 102485630, 323220947, 563900715, 389836245, 681458092, 459584506, 168053915, 653403636, 711815585, 16356414, 400016729, 662940721, 472950980, 254919269, 170728347, 77810782, 123134913, 504592001, 323024643, 26653245, 720159636, 23892256, 612682072, 607172589, 646178043, 30894048, 719878905, 155357348, 151443848, 500346557, 697804271, 711781205, 105628881, 230333004, 384987390, 311225559, 183701, 284124657, 69804057, 739828283, 676499074, 475371052, 560455734, 64544242, 712375818, 620304106, 521343536, 385784703, 686617203, 89709196, 195208386, 70578185, 650930348, 132510821, 469883387, 319540895, 737323226, 27729984, 268841443, 131985986, 348117557, 544073585, 168860837, 676518199, 43033387, 170313389, 414247863, 733909081, 652739066, 669414007, 33214390, 568404428, 661304262, 740291694, 265396235, 184729875, 222419614, 68391939, 597751488, 738237590, 692791833, 732721517, 475847352, 740920520, 740187543, 569967342, 422526003, 710691244, 9865319, 728390358, 178559079, 487270524, 709125350, 159870962, 429136213, 619264783, 162297531, 105857634, 50221377, 611068329, 310821554, 535412000, 294750497, 563698582, 732720881, 96097626, 135389506, 494882634, 235828663, 249420456, 155633692, 215027188, 197864239, 179185297, 648303770, 561056414, 111196656, 167384734, 667213593, 479384104, 740038433, 739597297, 738572658, 300523348, 709995185, 172405018, 134488375, 689108382, 492239935, 412291251, 236417455, 32473580, 639755952, 702579972, 671877074, 64507014, 741518965, 72005671, 10022483, 138256203, 187673713, 45287797, 684134480, 271123914, 690355603, 546015868, 438460742, 475561367, 694596611, 612927247, 17827142, 713030419, 680801659, 467677977, 87403146, 217614050, 741512427, 310170802, 638097805, 162469432, 669194177, 711065089, 4352290, 281589522, 707761857, 284535667, 679174015, 4364283, 717325279, 395754630, 201565374, 260284314, 615086045, 692563473, 738474857, 143390072, 558473071, 489204032, 661286485, 223614220, 213268539, 614849529, 624161699, 396454041, 701222590, 558491274, 737964511, 711941019, 669199695, 145595523, 717158975, 218862149, 258009934, 95708602, 191420798, 131763542, 598207051, 46320250, 687065963, 217275402, 615440204, 52001054, 573827921, 555122755, 64516340, 345571396, 741515576, 196383108, 701379124, 712002646, 982115, 435274528, 60297625, 6151150, 411106067, 150403916, 741386487, 7163364, 49385895, 550935663, 437622541, 741496135, 257262476, 41909592, 662416058, 434770271, 35009215, 686799838, 295838144, 131668701, 29927143, 740690619, 739733467, 322585599, 312300346, 401977317, 600057148, 202560877, 675016589, 145429630, 162283241, 103091490, 280251436, 490769504, 622090398, 741490949, 449517137, 739833751, 66049174, 328074345, 586765593, 635986554, 93124476, 587559062, 58844851, 184894903, 240652327, 734437461, 19208465, 534813779, 169515762, 478919058, 125956080, 708636796, 13733800, 356966364, 399613579, 302047851, 459785012, 714397937, 245560946, 37364650, 182483841, 623516618, 734794102, 279781116, 229386461, 382788385, 142645400, 603954180, 581732551, 181829350, 610570083, 461378935, 555908831, 676093039, 29533530, 5143928, 733673361, 346120516, 702297748, 707960291, 144189281, 477171398, 500721217, 549717515, 568118014, 379249266, 5979452, 2200935, 254222648, 552359079, 660056807, 618004595, 44715013, 251842065, 628324337, 152618411, 709188973, 575891082, 69885545, 690908301, 702405782, 324975002, 365596629, 142547704, 704370140, 151592964, 98505344, 512032855, 688585586, 515479893, 317750273, 741508319, 321106293, 132137220, 739734122, 637293453, 320644462, 183468357, 608295493, 52666448, 732807256, 99714009, 733469535, 252184854, 24146010, 57333976, 181679107, 204845103, 349133420, 710729321, 261377956, 123220723, 155808920, 667790296, 331174938, 731563571, 488753064, 144683582, 455688138, 29616328, 739590126, 656512967, 517146376, 428474174, 141205335, 126400747, 524840733, 34123639, 741320511, 736072110, 331995598, 265296359, 45765832, 740981774, 741409224, 457284922, 675835926, 718963225, 19024834, 153486204, 591704105, 741408868, 598253806, 392885120, 92355890, 741408307, 161307461, 739719153, 676886847, 435591342, 171935458, 9862483, 151425166, 100945193, 449772602, 741407935, 200578118, 31808052, 561902336, 570329706, 118850906, 435990933, 235704285, 251131165, 63829996, 457753653, 223899669, 306928453, 351022338, 97659415, 618997225, 712391229, 6453856, 394141107, 248123717, 605696814, 741504453, 24898673, 267353274, 6577905, 28000740, 132128884, 709730332, 123010751, 738166223, 474965523, 161795286, 63473919, 380477035, 514969977, 587373078, 689372328, 435708581, 741422947, 474877162, 192172662, 712003471, 686392119, 308559128, 26758043, 96681968, 23981360, 239699441, 373578738, 340483859, 204989051, 120801256, 84911774, 733108529, 712595287, 722625878, 176559599, 163692705, 6734053, 650004542, 3016967, 138922761, 166189832, 357151358, 422911240, 55472706, 216924688, 655765590, 332248487, 1885967, 505137385, 93403690, 73693173, 174892214, 251151615, 275391270, 147469685, 409191826, 646431416, 274972072, 516615457, 710822183, 406692659, 584320643, 502827079, 284112099, 553572183, 7594804, 322293959, 590784031, 224572783, 391615888, 677276634, 260090012, 34575754, 615610104, 15089499, 147829022, 336363367, 160602100, 724156619, 578277823, 142088033, 716861500, 175707719, 87509250, 449021276, 737738240, 238402160, 12004807, 321834850, 140668139, 2946238, 132303427, 253736560, 738304739, 154464612, 52088325, 518506732, 734811214, 67904345, 691530397, 185589255, 58186284, 10695000, 151558816, 140068966, 58939142, 33499470, 718912534, 321328550, 148948651, 526743022, 475317417, 141921999, 112726053, 740270072, 707101381, 332385296, 301531929, 536284361, 441355355, 222904461, 735414567, 176070766, 452056280, 422375675, 43544835, 155442597, 738697806, 207018471, 138190117, 376674052, 60106913, 741627400, 741607295, 741571868, 675263131, 661061825, 730498387, 632579349, 176758341, 349440924, 741099044, 146927341, 620432158, 541510827, 309251305, 125791226, 15153654, 626860861, 725845531, 632241292, 735629996, 692538089, 741561383, 156771213, 594787132, 734942006, 554148110, 602146331, 712841107, 272215607, 734449800, 741557833, 133176681, 452500963, 351859885, 707565640, 696110306, 176290783, 728987077, 605250923, 270998788, 467768671, 741559768, 114302083, 648877824, 359422435, 77337946, 474413814, 526361044, 214707223, 393600612, 711981408, 172498269, 229819160, 741622498, 740573988, 592335612, 66940524, 731438548, 590356536, 741552837, 51022939, 691313174, 551861217, 675654147, 741504826, 589040422, 704285597, 380217409, 741520713, 376033863, 688647932, 4641391, 702990092, 499431696, 741552519, 543913934, 740518728, 656778609, 739943744, 684069782, 739851475, 8021192, 63570737, 440867061, 144072314, 613150691, 165640584, 645328454, 183716827, 735244178, 191810491, 711212678, 34352678, 155442258, 740940395, 654269673, 741554891, 360224439, 404145198, 190682515, 720941209, 575896535, 741532267, 649059850, 589357588, 741551430, 567451101, 176060878, 741551063, 422313991, 649870377, 23133443, 69776346, 679061344, 341424527, 741554360, 586333058, 614859887, 434072213, 545636888, 158996982, 645398325, 738498697, 689249476, 195024414, 137030179, 709262834, 73567548, 692759314, 317372295, 573463915, 166117690, 553483249, 44769248, 509023102, 632932495, 604010626, 301577394, 660677583, 20439987, 741522129, 734923687, 307947391, 735145878, 457479880, 741552915, 257896206, 485405059, 545900279, 741624154, 547896744, 731588320, 695822901, 476151807, 716893496, 584432196, 40499907, 178663290, 156861079, 155927407, 206431845, 514451520, 685492328, 664944275, 221759706, 341722375, 614295311, 741621233, 741174690, 484605549, 155593314, 242931278, 85673986, 345132384, 37937864, 373932248, 645033792, 305621752, 729151375, 430033637, 731220174, 426051816, 633134539, 369502191, 600612394, 738994370, 124178164, 741625651, 559631676, 523064401, 703461517, 741623108, 654169708, 185082478, 523082183, 163323345, 579833854, 697265551, 243279678, 739991444, 615632896, 678729192, 732618033, 612920763, 523248814, 526734758, 274155923, 535576925, 142530017, 677438106, 182797, 740963786, 34784778, 634726525, 201673379, 698315009, 505521621, 37276322, 94732819, 615850858, 263880599, 569562178, 737071207, 133011104, 295387325, 154570566, 395865597, 710379750, 722417318, 160567220, 59235134, 286242002, 611522588, 702558504, 731956635, 741180747, 591432341, 222439998, 619875996, 581703977, 706048113, 644510705, 472655375, 415214995, 565479884, 741429886, 386935178, 618222517, 577390035, 71792982, 56445415, 570897989, 406305806, 424311758, 191289148, 346325079, 85799688, 500022608, 201538306, 741611478, 619035317, 4488833, 49449470, 271310536, 704073826, 588537519, 741568142, 734292402, 506892433, 738116047, 659807507, 591656716, 741625846, 604332191, 604709400, 729685757, 660223503, 92629568, 738498365, 672810686, 554609199, 613366668, 587047933, 575285049, 614628386, 741158700, 591464506, 597970241, 627988333, 582994122, 654800774, 134138970, 720734797, 27773212, 639907654, 515158032, 355592446, 718262657, 469355432, 411765412, 586821057, 419718202, 4423488, 545681737, 703756057, 514423001, 104203812, 679697458, 353887993, 179404198, 27471549, 728794634, 631075441, 640992547, 154364216, 326591268, 738153365, 717887641, 157626513, 700814684, 732408462, 280276204, 220310572, 62982884, 29302303, 627651992, 657225051, 193631081, 94990998, 701469633, 648321694, 739463044, 523068331, 31716161, 400081502, 688931484, 521434566, 592114620, 716873409, 736491968, 739456338, 710834933, 730821481, 670924499, 613431926, 737222706, 556699339, 592821389, 106957774, 102129859, 225101911, 564484027, 72593659, 615688509, 70125525, 480488183, 514762467, 100472284, 587602638, 296821681, 524213664, 673766689, 738151314, 741624280, 739873594, 210600382, 423369770, 740909757, 741568421, 674101048, 217830909, 427819197, 314926526, 558322579, 737228459, 736470853, 741519881, 105378071, 740850070, 741600539, 567000455, 666822948, 287624392, 701863045, 741621780, 740895685, 160117998, 739804880, 35855942, 93061090, 66961098, 717065799, 517263601, 499598512, 712497753, 23069030, 90634444, 694037626, 643666776, 739260175, 61153830, 519166124, 416751970, 65115916, 670170893, 142494541, 460927191, 663787593, 10058476, 738332940, 490159713, 740224918, 282146489, 664755116, 454917355, 454495835, 740908520, 408356803, 314961397, 409539584, 700927398, 11962510, 568741202, 414300693, 705666161, 741549736, 739758323, 356266166, 712434556, 741534227, 736492670, 680017014, 458747187, 218952233, 677414387, 171526627, 302352757, 322623084, 149414939, 576812784, 45736340, 737231130, 369594587, 735730047, 300902370, 549796636, 510347071, 78184320, 82696318, 736427532, 730027086, 575019621, 675582254, 589722277, 696322186, 741622453, 313844566, 608776911, 707988769, 575915875, 188921149, 741622972, 741621467, 158946237, 674759656, 710873525, 230030491, 532128639, 482640433, 257937666, 575799751, 652843235, 733094142, 741466075, 645171949, 738249177, 741623577, 735894765, 271092122, 552503575, 431527781, 558429294, 697109946, 741586652, 647567686, 708102885, 198768268, 18383214, 715728202, 52410274, 741575019, 497107489, 173317028, 741617571, 741604004, 571563840, 719408444, 482157955, 614955592, 41090544, 496004682, 722259572, 158545993, 18847875, 741601238, 561590865, 648039249, 711932285, 613742495, 562187197, 735135544, 553865211, 548657927, 17353098, 583857405, 269482702, 737226309, 404946886, 641128491, 699029079, 157272681, 228231110, 630450120, 163450757, 731276255, 740467121, 737347609, 734871916, 658016869, 340459415, 318049414, 740019649, 386070770, 197822206, 641568163, 346529138, 696012563, 536255468, 685790127, 319342548, 674619870, 340684701, 294935692, 713886517, 626995215, 587509275, 1918631, 51990221, 450521566, 656057620, 687372870, 19099425, 672982943, 410414798, 705499437, 714832263, 118467304, 64260432, 329729333, 736497749, 677934499, 722538983, 733615544, 737228368, 508278474, 736456897, 643430396, 738789175, 633959214, 715087702, 141245179, 577589468, 483840113, 737680460, 583190309, 741470371, 291810782, 173169181, 28349825, 201946642]

    mapp = [
        {'soc_type': 1, 'source_type': 1, 'source_id': x} for x in lst
    ]

    stmt = insert(Source).values(mapp)

    await session.execute(stmt)


@execute_transaction
async def get_source_ids(offset: int, limit: int, source_type: int = 1,  **kwargs) -> List[Tuple]:
    """ Получение уникальных идентификаторов соцсети Вконтакте пользователей. """

    session = kwargs.get('session')

    stmt = select(Source.source_id).where(Source.source_type == source_type).order_by(Source.res_id).offset(offset).limit(limit)

    chunked_iterator_result = await session.execute(stmt)

    ids = chunked_iterator_result.fetchall()

    return ids


@execute_transaction
async def get_source_ids_count(source_type: int = 1, **kwargs) -> int:
    """ Получение общего количества доступных source_id.
        :source_id: идентификатор пользовтеля/группы Вконтакте. """

    session = kwargs.get('session')

    stmt = select(func.count(Source.source_id)).select_from(Source).where(Source.source_type == source_type)

    count = await session.execute(stmt)

    return count.scalar() or 0


@execute_transaction
async def insert_hashes_of_users_by_source_id(data: List[Tuple[int, str]], **kwargs) -> List[Tuple[int]]:

    session = kwargs.get('session')

    stmt = select(Source.res_id).where(Source.source_id.in_([tpl[0] for tpl in data]))

    res_ids = await session.execute(stmt)
    res_ids = res_ids.fetchall()

    _map = [
        {'social_info_hash': data[1]} for _hash in data
    ]
    # ПРОДОЛЖАЕМ ОТСЮДА!
    stmt = insert(ScrapperHash).values(_map)

    return res_ids


@execute_transaction
async def insert_into_source_user_profile(user_profile: Dict, **kwargs):
    """ Добавление данных о пользователе Вконтакте. """

    session = kwargs.get('session')

    to_relational_fields = await cleanup_user_profile_data(user_profile, delta=False)
    to_json_field = await cleanup_user_profile_data(user_profile, delta=True)
    to_relational_fields_mapped = await map_vk_user_keys_with_database_fields(to_relational_fields)
    json_field = json.dumps(to_json_field)

    source_id = to_relational_fields_mapped.pop('id')
    stmt = select(Source.res_id).filter_by(source_id=source_id)
    result = await session.execute(stmt)
    res_id = result.scalar()

    stmt = insert(UserProfile).values(res_id=res_id, **to_relational_fields_mapped, info_json=json_field)

    await session.execute(stmt)


@execute_transaction
async def insert_into_source_subscription(user_subscription: Dict, user_source_id: int, **kwargs):

    session = kwargs.pop('session')

    to_relational_fields = await cleanup_subscription_profile_data(user_subscription, delta=False)
    to_json_field = await cleanup_subscription_profile_data(user_subscription, delta=True)
    to_relational_fields_mapped = await map_vk_subscription_keys_with_database_fields(to_relational_fields)
    json_field = json.dumps(to_json_field)

    subscription_source_id = to_relational_fields_mapped.pop('id')

    stmt = insert(Source).values(soc_type=1, source_id=subscription_source_id, source_type=2)
    await session.execute(stmt)

    user_profile = select(Source.res_id).filter_by(source_id=user_source_id)
    user_profile = await session.execute(user_profile)

    subscription = select(Source.res_id).filter_by(source_id=subscription_source_id)
    subscription = await session.execute(subscription)

    user_profile_res_id = user_profile.scalar()
    subscription_res_id = subscription.scalar()

    stmt = insert(UserSubscription).values(user_res_id=user_profile_res_id, subscription_res_id=subscription_res_id, status=1)
    await session.execute(stmt)

    stmt = insert(SubscriptionProfile).values(res_id=subscription_res_id, **to_relational_fields_mapped, info_json=json_field)
    await session.execute(stmt)


@execute_transaction
async def check_if_hash_exists(res_id: int, **kwargs) -> bool:
    """ Проверяем существует ли хэш запись в таблице scrapper hash.
        :res_id: идентификатор аккаунта в системе. """

    session = kwargs.get('session')

    stmt = select(ScrapperHash.social_info_hash).select_from(
        join(ScrapperHash, Source, ScrapperHash.res_id == Source.res_id)
    ).where(Source.res_id == res_id)

    has_hash = await session.execute(stmt)
    has_hash = has_hash.scalar()

    if has_hash:
        return True
    return False


async def check_if_user_updated_profile(res_id: int) -> bool:
    """ Проверка связанного с профилем пользователя хэша в базе данных. """

    pass


# async def main():
#     x = await insert_into_source()
#     print(x)
#
# if __name__ == '__main__':
#     asyncio.run(main())
